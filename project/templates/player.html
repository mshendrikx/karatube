<!DOCTYPE html>
<html>

<head>
  <title>KaraTube</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/player.css') }}">
  <script>
    function getLatestInfo() {
        $.ajax({
            url: "/screenupdate",
            success: function(data) {
                $("#overlay-now").html(data.singer + ' - ' + data.song);
                $("#overlay-queued").html(data.next_singer + ' - ' + data.next_song);
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error("Error:", textStatus, errorThrown);
            }
        });
    }

    $(document).ready(function() {
        getLatestInfo();  // Get initial info on page load
        setInterval(getLatestInfo, 3000); // Check for updates every 3 seconds
    });
</script>
</head>

<body>
  <div class="video-container">
    <video id="video" autoplay controls playsinline></video>
    <span id="overlay-singing">Singing: </span>
    <span id="overlay-now">{{ player_data.singer }} - {{ player_data.song }}</span>
    <span id="overlay-next">Next:</span>
    <span id="overlay-queued">{{ player_data.next_singer }} - {{ player_data.next_song }}</span>

    <script>
      const videoElement = document.getElementById("video");

      videoElement.src = "{{ player_data.video_url }}";
      videoElement.load();
      videoElement.play();

      videoElement.addEventListener('ended', () => {
        // Fetch the next video URL from the server using AJAX
        fetch('/playerdata')
          .then(response => response.json())
          .then(data => {
            $('#overlay-now').text(data.singer + ' - ' + data.song);
            $('#overlay-queued').text(data.next_singer + ' - ' + data.next_song);
            videoElement.src = data.url;
            videoElement.load();
            videoElement.play();
          });
      });
    </script>
  </div>
</body>

</html>